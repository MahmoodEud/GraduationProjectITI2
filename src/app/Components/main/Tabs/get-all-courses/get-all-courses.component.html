<div class="container py-1 py-md-4">
  <!-- Search and Filters Section -->
  <div class="filters-section mb-4">
    <div class="filters-card">
      <form class="filter-form" (ngSubmit)="loadCourses()">
        <div class="search-wrapper">
          <input
            type="text"
            class="form-control search-input"
            placeholder="ابحث بالعنوان..."
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange($event)"
            name="search"
          />
        </div>
        <button type="button" (click)="resetFilters()" class="btn btn-reset">
          <i class="bi bi-arrow-clockwise me-2"></i>
          <span class="btn-text">إعادة تعيين</span>
        </button>
      </form>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading-container">
      <div class="loading-spinner">
        <div class="spinner-border text-primary" role="status" aria-label="جاري التحميل">
          <span class="visually-hidden">جاري التحميل...</span>
        </div>
        <p class="loading-text mt-3">جاري تحميل الكورسات...</p>
      </div>
    </div>
  }

  <!-- Error State -->
  @if (errorMessage && !isLoading) {
    <div class="alert alert-danger error-alert" role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      {{ errorMessage }}
    </div>
  }

  <!-- Courses Grid -->
  @if (!isLoading && !errorMessage && courses.length > 0) {
    <div class="courses-container">
      <div class="courses-grid">
        @for (course of courses; track course.id) {
          <div class="course-wrapper">
            <article class="course-card">
              <!-- Course Image Section -->
              <div class="course-image-wrapper">
                <img
                  [src]="getImageUrl(course.picturalUrl || 'default.jpg')"
                  [alt]="course.title"
                  class="course-image"
                  (error)="handleImageError($event)"
                  loading="lazy"
                />
                
                <!-- Price Badge -->
                <div class="badges-container">
                  <span
                    class="price-badge"
                    [ngClass]="{
                      'price-free': course.price === 0,
                      'price-paid': course.price > 0
                    }"
                  >
                    {{ course.price === 0 ? 'مجاني' : course.price + ' جنيه' }}
                  </span>
                  
                  <!-- Enrollment Badge -->
                  @if (enrolledCourseIds.includes(course.id)) {
                    <span class="enrolled-badge">
                      <i class="bi bi-check-circle-fill me-1"></i>
                      <span>مشترك</span>
                    </span>
                  }
                </div>
              </div>

              <!-- Course Content -->
              <div class="course-content">
                <header class="course-header">
                  <h3 class="course-title">{{ course.title }}</h3>
                  <p class="course-description">
                    {{ course.description | slice:0:100 }}...
                  </p>
                </header>
                
                <div class="course-meta">
                  <div class="course-year">
                    <i class="bi bi-calendar3 me-2"></i>
                    <span class="meta-label">السنة:</span>
                    <span class="meta-value">{{ course.year }}</span>
                  </div>
                </div>

                <!-- Action Buttons -->
                <div class="course-actions">
                  @if (enrolledCourseIds.includes(course.id)) {
                    <button 
                      class="btn btn-unenroll"
                      (click)="unenroll(course.id)"
                      type="button"
                    >
                      <i class="bi bi-trash me-2"></i>
                      <span>إلغاء التسجيل</span>
                    </button>
                  } @else if (course.price === 0) {
                    <button 
                      class="btn btn-enroll"
                      (click)="enrollInCourse(course.id)"
                      type="button"
                    >
                      <i class="bi bi-person-plus me-2"></i>
                      <span>تسجيل</span>
                    </button>
                  }
                  
                  <a 
                    [routerLink]="['/courses', course.id]" 
                    class="btn btn-details"
                    [attr.aria-label]="'عرض تفاصيل ' + course.title"
                  >
                    <i class="bi bi-eye me-2"></i>
                    <span>عرض التفاصيل</span>
                  </a>
                </div>
              </div>
            </article>
          </div>
        } @empty {
          <div class="empty-state-wrapper">
            <div class="empty-state">
              <i class="bi bi-mortarboard empty-icon"></i>
              <h4 class="empty-title">لا توجد كورسات متاحة</h4>
              <p class="empty-description">جرب البحث بكلمات مختلفة أو تحقق لاحقاً</p>
            </div>
          </div>
        }
      </div>

      <!-- Pagination -->
      <nav class="pagination-wrapper" aria-label="التنقل بين صفحات الكورسات">
        <div class="pagination-container">
          <button
            [disabled]="page === 1"
            (click)="onPageChange(page - 1)"
            class="btn btn-pagination btn-prev"
            type="button"
            aria-label="الصفحة السابقة"
          >
            <i class="bi bi-chevron-right me-1"></i>
            <span class="btn-text">السابق</span>
          </button>
          
          <div class="page-numbers">
            @for (pageNum of getPageNumbers(); track pageNum) {
              <button
                [class.active]="pageNum === page"
                (click)="onPageChange(pageNum)"
                class="btn btn-pagination btn-page"
                [attr.aria-label]="'الصفحة ' + pageNum"
                [attr.aria-current]="pageNum === page ? 'page' : null"
                type="button"
              >
                {{ pageNum }}
              </button>
            }
          </div>
          
          <button
            [disabled]="page === totalPages"
            (click)="onPageChange(page + 1)"
            class="btn btn-pagination btn-next"
            type="button"
            aria-label="الصفحة التالية"
          >
            <span class="btn-text">التالي</span>
            <i class="bi bi-chevron-left ms-1"></i>
          </button>
        </div>
      </nav>
    </div>
  } @else if (!isLoading && !errorMessage) {
    <!-- Empty State when no courses at all -->
    <div class="empty-state-wrapper">
      <div class="empty-state">
        <i class="bi bi-mortarboard empty-icon"></i>
        <h4 class="empty-title">لا توجد كورسات متاحة حالياً</h4>
        <p class="empty-description">تحقق مرة أخرى لاحقاً للحصول على كورسات جديدة</p>
      </div>
    </div>
  }
</div>