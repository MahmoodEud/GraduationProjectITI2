<div class="quiz-container mb-sm-0 mb-5 py-sm-0 py-5">
  @if (!loaded()) {
    <div class="loading-container text-center">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">جارِ التحميل...</span>
      </div>
      <p class="mt-3">جارِ تحميل الكويز...</p>
    </div>
  } @else {
    <div class="quiz-content">
      <div class="quiz-header d-flex justify-content-between align-items-center mb-4">
        <div class="quiz-info">
          <h4>الكويز - السؤال {{ idx() + 1 }} من {{ total() }}</h4>
          <div class="progress mb-2">
            <div class="progress-bar"
                 [style.width.%]="total() > 0 ? ((idx() + 1) / total()) * 100 : 0"></div>
          </div>
        </div>

        @if (timeRemainingFormatted()) {
          <div class="timer-container">
            <div class="alert mb-0"
                 [ngClass]="{
                   'alert-info': (timeRemaining() ?? 0) >= 300,
                   'alert-warning': (timeRemaining() ?? 0) < 300 && (timeRemaining() ?? 0) >= 60,
                   'alert-danger': (timeRemaining() ?? 0) < 60
                 }">
              <i class="fas fa-clock"></i>
              الوقت المتبقي: {{ timeRemainingFormatted() }}
            </div>
          </div>
        }
      </div>

      @if (currentQuestion()) {
        <div class="question-container">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">{{ currentQuestion()!.header }}</h5>
            </div>
            <div class="card-body">
              <p class="question-body">{{ currentQuestion()!.body }}</p>

              <div class="choices-container">
                @for (choice of currentQuestion()!.choices; track choice.id; let ci = $index) {
                  <div class="choice-item mb-3">
                    <div class="form-check">
                      <input class="form-check-input"
                             type="radio"
                             [id]="'choice_' + currentQuestion()!.id + '_' + ci"
                             [name]="'question_' + currentQuestion()!.id"
                             [value]="(choice?.id ?? ci)"
                             [checked]="getSelectedAnswer() === +(choice?.id ?? ci)"
                             (change)="select(currentQuestion()!.id, +(choice?.id ?? ci))">
                      <label class="form-check-label" [for]="'choice_' + currentQuestion()!.id + '_' + ci">
                        {{ choice.choiceText }}
                      </label>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      }

      <div class="navigation-container mt-4">
        <div class="row">
          <div class="col-md-6">
            <button type="button" class="btn btn-secondary"
                    [disabled]="idx() === 0 || submitting()"
                    (click)="prev()">
              <i class="fas fa-arrow-right"></i>
              السؤال السابق
            </button>
          </div>
          <div class="col-md-6 text-end">
            @if (idx() < total() - 1) {
              <button type="button" class="btn btn-primary"
                      [disabled]="submitting()"
                      (click)="next()">
                السؤال التالي
                <i class="fas fa-arrow-left"></i>
              </button>
            } @else {
              <button type="button" class="btn btn-success"
                      [disabled]="submitting()"
                      (click)="submit()">
                @if (submitting()) {
                  <span class="spinner-border spinner-border-sm me-2"></span>
                }
                تسليم الكويز
              </button>
            }
          </div>
        </div>
      </div>

      <div class="question-navigator mt-0 mb-sm-0 mb-5 py-sm-0 py-5">
        <h6>الانتقال إلى سؤال:</h6>
        <div class="question-buttons">
          @for (question of questions(); track question.id; let i = $index) {
            <button type="button"
                    class="btn btn-sm me-2 mb-2"
                    [class.btn-success]="hasAnswer(question.id)"
                    [class.btn-primary]="idx() === i && !hasAnswer(question.id)"
                    [class.btn-outline-secondary]="idx() !== i && !hasAnswer(question.id)"
                    (click)="goToQuestion(i)">
              {{ i + 1 }}
            </button>
          }
        </div>
      </div>
    </div>
  }
</div>