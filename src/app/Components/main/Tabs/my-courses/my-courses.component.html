<div class="container-fluid px-2 px-md-4 py-3 py-md-4">
    @if (isLoading) {
    <div class="loading-container text-center my-5 py-5">
      <div class="loading-spinner mb-4">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">جاري التحميل...</span>
        </div>
      </div>
      <h5 class="text-muted fw-medium">جاري تحميل الكورسات...</h5>
      <p class="text-muted small mb-0">يرجى الانتظار قليلاً</p>
    </div>
  }
  @if (errorMessage && !isLoading) {
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-6">
        <div class="alert alert-danger d-flex align-items-center p-4" role="alert">
          <i class="fas fa-exclamation-triangle fs-4 me-3"></i>
          <div>
            <h6 class="alert-heading mb-1">حدث خطأ!</h6>
            <p class="mb-0">{{ errorMessage }}</p>
          </div>
        </div>
      </div>
    </div>
  }

  @if (!isLoading && !errorMessage && courses.length > 0) {
    
    <div class="row mb-4">
      <div class="col-12">
        <div class="stats-card card border-0 shadow-sm">
          <div class="card-body p-3 p-md-4">
            <div class="row g-3 text-center">
              <div class="col-6 col-md-3">
                <div class="stat-item">
                  <div class="stat-icon bg-primary bg-opacity-10 mx-auto mb-2">
                    <i class="fas fa-graduation-cap text-primary"></i>
                  </div>
                  <div class="stat-value text-primary fw-bold">{{ courses.length }}</div>
                  <div class="stat-label text-muted small">دورة مسجلة</div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="stat-item">
                  <div class="stat-icon bg-success bg-opacity-10 mx-auto mb-2">
                    <i class="fas fa-chart-line text-success"></i>
                  </div>
                  <div class="stat-value text-success fw-bold">
                    {{ getAverageProgress() | number:'1.0-0' }}%
                  </div>
                  <div class="stat-label text-muted small">متوسط التقدم</div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="stat-item">
                  <div class="stat-icon bg-warning bg-opacity-10 mx-auto mb-2">
                    <i class="fas fa-star text-warning"></i>
                  </div>
                  <div class="stat-value text-warning fw-bold">
                    {{ getCompletedCourses() }}
                  </div>
                  <div class="stat-label text-muted small">دورة مكتملة</div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="stat-item">
                  <div class="stat-icon bg-info bg-opacity-10 mx-auto mb-2">
                    <i class="fas fa-play text-info"></i>
                  </div>
                  <div class="stat-value text-info fw-bold">
                    {{ getInProgressCourses() }}
                  </div>
                  <div class="stat-label text-muted small">قيد الدراسة</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row mb-sm-0 py-sm-0 mb-5 ">
      <div class="col-12">
        <div class="courses-container py-sm-0 py-5 mb-sm-0 mb-5">
          <div class="courses-grid row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xl-4 g-3 g-md-4">
            @for (course of courses; track course.id) {
              <div class="col">
                <div class="course-card card h-100 border-0 shadow-sm overflow-hidden">
                  
                  <!-- Course Image -->
                  <div class="course-image-container position-relative">
                    <img
                      [src]="getImageUrl(course.picturalUrl || 'default.jpg')"
                      alt="{{ course.title }}"
                      class="card-img-top course-image"
                      (error)="handleImageError($event)"
                    />
                    
                    <div class="image-overlay"></div>
                    
                    <div class="position-absolute top-0 end-0 m-2">
                      <span class="badge bg-success bg-gradient px-3 py-2 shadow-sm">
                        <i class="fas fa-check-circle me-1"></i>مشترك
                      </span>
                    </div>
                    
                    <!-- Price Badge -->
                    <div class="position-absolute top-0 start-0 m-2">
                      <span class="badge px-3 py-2 shadow-sm"
                            [ngClass]="{'bg-success bg-gradient': course.price === 0, 'bg-warning bg-gradient text-dark': course.price > 0}">
                        <i class="fas me-1" [ngClass]="{'fa-gift': course.price === 0, 'fa-tag': course.price > 0}"></i>
                        {{ course.price === 0 ? 'مجاني' : course.price + ' جنيه' }}
                      </span>
                    </div>
                    
                    @if (!loadingProgress[course.id] && (progressByCourseId[course.id]) > 0) {
                      <div class="position-absolute bottom-0 start-0 end-0">
                        <div class="progress" style="height: 4px; border-radius: 0;">
                          <div class="progress-bar bg-primary"
                               role="progressbar"
                               [style.width.%]="progressByCourseId[course.id] "
                               aria-valuemin="0"
                               aria-valuemax="100">
                          </div>
                        </div>
                      </div>
                    }
                  </div>

                  <div class="card-body p-3 p-md-4 d-flex flex-column">
                    
                    <div class="course-content flex-grow-1">
                      <h5 class="card-title fw-bold text-dark mb-2 line-clamp-2">
                        {{ course.title }}
                      </h5>
                      
                      <p class="card-text text-muted small mb-3 line-clamp-3">
                        {{ course.description }}...
                      </p>
                      
                      <div class="course-meta mb-3">
                        <div class="d-flex align-items-center text-muted small">
                          <i class="fas fa-calendar-alt me-2"></i>
                          <span>السنة: {{ course.year }}</span>
                        </div>
                      </div>
                    </div>

                    <div class="progress-section mb-3">
                      @if (loadingProgress[course.id]) {
                        <div class="d-flex align-items-center text-muted small">
                          <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                          <span>جاري حساب التقدم...</span>
                        </div>
                      } @else {
                        <div class="progress-info mb-2">
                          <div class="d-flex justify-content-between align-items-center small">
                            <span class="text-muted">
                              <i class="fas fa-chart-line me-1"></i>التقدم
                            </span>
                            <span class="fw-bold text-primary">
                              {{ (progressByCourseId[course.id] ) | number:'1.0-0' }}%
                            </span>
                          </div>
                        </div>
                        
                        <div class="progress progress-custom" style="height: 8px;">
                          <div class="progress-bar bg-primary"
                               role="progressbar"
                               [style.width.%]="progressByCourseId[course.id] "
                               [attr.aria-valuenow]="progressByCourseId[course.id]"
                               aria-valuemin="0"
                               aria-valuemax="100">
                          </div>
                        </div>
                      }
                    </div>

                    <div class="course-actions d-flex flex-column gap-2">
                      <a [routerLink]="['/courses', course.id]" 
                         class="btn btn-primary btn-sm d-flex align-items-center justify-content-center">
                        <i class="fas fa-eye me-2"></i>
                        عرض التفاصيل
                      </a>
                      
                      <button class="btn btn-outline-danger btn-sm d-flex align-items-center justify-content-center" 
                              (click)="unenroll(course.id)"
                              type="button">
                        <i class="fas fa-trash-alt me-2"></i>
                        إلغاء التسجيل
                      </button>
                    </div>

                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    </div>

  } @else if (!isLoading && !errorMessage) {
    
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-6">
        <div class="empty-state text-center py-5">
          <div class="empty-icon mb-4">
            <i class="fas fa-book-open text-muted" style="font-size: 4rem; opacity: 0.3;"></i>
          </div>
          <h4 class="text-muted fw-bold mb-2">لا توجد كورسات</h4>
          <p class="text-muted mb-4">لا توجد كورسات مشترك فيها حالياً</p>
          <a href="/courses" class="btn btn-primary">
            <i class="fas fa-search me-2"></i>
            تصفح الكورسات المتاحة
          </a>
        </div>
      </div>
    </div>
  }

</div>





<style>


  /* Header Styles */
  .page-header {
    border: none;
    background: linear-gradient(135deg, #343a40 0%, #495057 100%) !important;
  }

  .header-icon {
    opacity: 0.9;
  }

  /* Stats Card */
  .stats-card {
    border-radius: 16px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .stats-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.1);
  }

  .stat-item {
    padding: 1rem;
  }

  .stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
  }

  .stat-value {
    font-size: 1.8rem;
    margin: 0.5rem 0 0.25rem;
  }

  .stat-label {
    font-weight: 500;
  }

  /* Course Card Styles */
  .course-card {
    border-radius: 16px;
    transition: all 0.3s ease;
    overflow: hidden;
  }

div course-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 60px rgba(0,0,0,0.15);
  }

  .course-image-container {
    overflow: hidden;
    height: 200px;
  }

  .course-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .course-card:hover .course-image {
    transform: scale(1.05);
  }

  .image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      to bottom,
      transparent 0%,
      transparent 60%,
      rgba(0,0,0,0.1) 100%
    );
    pointer-events: none;
  }

  /* Text Utilities */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Progress Bar */
  .progress-custom {
    border-radius: 10px;
    background-color: #f8f9fa;
  }

  .progress-bar {
    border-radius: 10px;
  }

  /* Loading Spinner */
  .loading-container {
    min-height: 300px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .loading-spinner {
    position: relative;
  }

  /* Empty State */
  .empty-state {
    min-height: 300px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .empty-icon {
    margin-bottom: 2rem;
  }

  /* Button Enhancements */
  .btn {
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  .btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
  }

  .btn-outline-danger:hover {
    transform: translateY(-1px);
  }

  /* Badge Enhancements */
  .badge {
    font-weight: 500;
    letter-spacing: 0.02em;
    border-radius: 8px;
  }

  /* Responsive Design */
  @media (max-width: 576px) {
    .container-fluid {
      padding-left: 1rem;
      padding-right: 1rem;
    }
    
    .page-header {
      padding: 1.5rem !important;
      margin-bottom: 2rem !important;
    }
    
    .page-header h2 {
      font-size: 1.5rem;
    }
    
    .header-icon {
      font-size: 2rem !important;
    }
    
    .course-image-container {
      height: 150px;
    }
    
    .card-body {
      padding: 1rem !important;
    }
    
    .stat-item {
      padding: 0.5rem;
    }
    
    .stat-value {
      font-size: 1.4rem;
    }
    
    .stat-icon {
      width: 40px;
      height: 40px;
      font-size: 1rem;
    }
    
    .course-actions {
      gap: 0.5rem !important;
    }
  }

  @media (max-width: 768px) {
    .courses-grid {
      gap: 1rem !important;
    }
    
    .stats-card .card-body {
      padding: 1.5rem !important;
    }
  }

  @media (min-width: 992px) {
    .course-image-container {
      height: 220px;
    }
  }

  @media (min-width: 1200px) {
    .courses-grid {
      gap: 1.5rem !important;
    }
  }
</style>