<!-- change-password.component.html -->
<div class="container py-4" dir="rtl">
  <div class="row justify-content-center">
    <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5">
      <div class="card shadow-sm border-0">
        <div class="card-header text-center">
          <h5 class="mb-0 text-white">
            <i class="bi bi-shield-lock me-2"></i>
            تغيير كلمة المرور
          </h5>
        </div>

        <div class="card-body p-4">
          <!-- Error Alert -->
          <div *ngIf="errorMsg" class="alert alert-danger d-flex align-items-center mb-4" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <div>{{ errorMsg }}</div>
          </div>

          <!-- Success Alert -->
          <div *ngIf="successMsg" class="alert alert-success d-flex align-items-center mb-4" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i>
            <div>{{ successMsg }}</div>
          </div>

          <form #changePasswordForm="ngForm" (ngSubmit)="submit(changePasswordForm)" autocomplete="off" novalidate>
            <div class="row g-4">
              
              <!-- Current Password -->
              <div class="col-12">
                <label for="currentPassword" class="form-label">
                  <i class="bi bi-key me-2"></i>
                  كلمة المرور الحالية
                </label>
                <div class="input-group">
                  <input 
                    [type]="showCurrentPassword ? 'text' : 'password'"
                    class="form-control pe-5"
                    id="currentPassword"
                    name="currentPassword"
                    [(ngModel)]="model.currentPassword"
                    required
                    #currentPassword="ngModel"
                    autocomplete="current-password"
                    [disabled]="isLoading"
                    [class.is-invalid]="currentPassword.invalid && currentPassword.touched">
                  <button 
                    type="button" 
                    class="password-toggle"
                    [disabled]="isLoading"
                    (click)="togglePasswordVisibility('current')">
                    <i [class]="showCurrentPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                  </button>
                </div>
                <div class="invalid-feedback" 
                     *ngIf="currentPassword.invalid && currentPassword.touched">
                  يرجى إدخال كلمة المرور الحالية
                </div>
              </div>

              <!-- New Password -->
              <div class="col-12">
                <label for="newPassword" class="form-label">
                  <i class="bi bi-shield-check me-2"></i>
                  كلمة المرور الجديدة
                </label>
                <div class="input-group">
                  <input 
                    [type]="showNewPassword ? 'text' : 'password'"
                    class="form-control pe-5"
                    id="newPassword"
                    name="newPassword"
                    [(ngModel)]="model.newPassword"
                    required
                    minlength="8"
                    #newPassword="ngModel"
                    autocomplete="new-password"
                    [disabled]="isLoading"
                    [class.is-invalid]="newPassword.invalid && newPassword.touched">
                  <button 
                    type="button" 
                    class="password-toggle"
                    [disabled]="isLoading"
                    (click)="togglePasswordVisibility('new')">
                    <i [class]="showNewPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                  </button>
                </div>
                <div class="invalid-feedback" 
                     *ngIf="newPassword.invalid && newPassword.touched">
                  <span *ngIf="newPassword.errors?.['required']">يرجى إدخال كلمة المرور الجديدة</span>
                  <span *ngIf="newPassword.errors?.['minlength']">كلمة المرور يجب أن تكون 8 أحرف على الأقل</span>
                </div>
              </div>

              <!-- Confirm Password -->
              <div class="col-12">
                <label for="confirmPassword" class="form-label">
                  <i class="bi bi-shield-check me-2"></i>
                  تأكيد كلمة المرور الجديدة
                </label>
                <div class="input-group">
                  <input 
                    [type]="showConfirmPassword ? 'text' : 'password'"
                    class="form-control pe-5"
                    id="confirmPassword"
                    name="confirmPassword"
                    [(ngModel)]="model.confirmPassword"
                    required
                    #confirmPassword="ngModel"
                    autocomplete="new-password"
                    [disabled]="isLoading"
                    [class.is-invalid]="(confirmPassword.invalid && confirmPassword.touched) || 
                                         (confirmPassword.valid && model.newPassword !== model.confirmPassword && model.confirmPassword !== '')">
                  <button 
                    type="button" 
                    class="password-toggle"
                    [disabled]="isLoading"
                    (click)="togglePasswordVisibility('confirm')">
                    <i [class]="showConfirmPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                  </button>
                </div>
                <div class="invalid-feedback" 
                     *ngIf="(confirmPassword.invalid && confirmPassword.touched) || 
                            (confirmPassword.valid && model.newPassword !== model.confirmPassword && model.confirmPassword !== '')">
                  <span *ngIf="confirmPassword.errors?.['required']">يرجى تأكيد كلمة المرور</span>
                  <span *ngIf="model.newPassword !== model.confirmPassword && model.confirmPassword !== ''">كلمات المرور غير متطابقة</span>
                </div>
              </div>
            </div>

            <hr class="my-4">

            <div class="d-flex gap-2 justify-content-end flex-column-reverse flex-sm-row">
              <button 
                type="button" 
                class="btn btn-outline-primary"
                [disabled]="isLoading"
                (click)="cancel()">
                <i class="bi bi-x-circle me-2"></i>
                إلغاء
              </button>
              <button 
                type="submit" 
                class="btn btn-primary"
                [disabled]="isLoading || !changePasswordForm.valid || model.newPassword !== model.confirmPassword">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status"></span>
                <i *ngIf="!isLoading" class="bi bi-check-circle me-2"></i>
                {{ isLoading ? 'جاري الحفظ...' : 'حفظ التعديلات' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>